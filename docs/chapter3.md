# chapter3

## サービスコンテナ

Laravelの重要な仕組みのひとつ。

- クラスの依存関係の管理
- 依存性の注入

という役割を担う。

OOPにおいて、クラスAが内部でクラスBを呼び出してインスタンスを生成しているとき、Aの動作にはBが必須となり「クラスAはクラスBに依存している」といえる。

### 依存性の注入 (Dependency Injection, DI)

**「クラスの中で使いたいインスタンスやロジックを、クラスの外から受け取る」** こと。

具体的には、直接クラスAからクラスBを呼び出すのではなく、外部でクラスBから生成したインスタンスをコンストラクタの引数として受け取るようにする。

最終的に「クラスAが、クラスBのインスタンスを必要としている」こと自体は変わらないが、クラスBが責務を負うべきロジックに振り回されずクラスAを実装できるため、クラス単体でのテスト容易性が向上する（たとえば、ダミーのインスタンスを渡してテストすることも可能）。

## Laravelのサービスコンテナ

Laravelでは、あらかじめ用意した任意のサービスクラスをコントローラー上で読み込むだけで、「インスタンスの生成と注入」を意識せずとも依存性注入をうまいことやってくれる。

```php
{
    /**
     * Handle the incoming request.
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\Response
     */
    public function __invoke(Request $request, TweetService $tweetService)
    {
```

上記において、Laravelは`Request`クラスおよび`TweetService`クラスからインスタンスを生成し、`$request`や`$tweetService`として受け取るまでの処理を自動化している（ユーザーはクラスを`use`で宣言して読み込むだけでよい）。

## ログイン機能の実装

認証系は基本的にロジック丸ごと自前実装することは少ない。今回は `Laravel Breeze`を利用する。

※インストール時に既存コードを上書きしてくるため注意。フロントエンドにtailwindを組み込んできたりわりとがっつり手を入れてくる。

コードは自動生成されるものを利用する形で問題ないが、中身を理解しておかないと応用が効かない。以下でLaravel Breezeが生成する認証系コードについて解説する。

